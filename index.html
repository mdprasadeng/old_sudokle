<html>
    <title>Sudokle</title>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">
        var startGuess = ["x","x","x","x","x","x","x","x","x"];
        function onNew() {
            window.location.hash = "";
            window.location.reload();
        }
        function onGuess()
        {
            
            window.try++;
            if (window.try <= window.maxTries && guess.length == 9) {
                var colors = getColors(guess);
                var grid = document.getElementById("grid"+window.try);
                var tds = grid.getElementsByTagName("td");
                for (var i=0; i < 9; i++) {
                    tds[i].innerHTML = guess[i];
                    tds[i].style["background"] = colors[i];
                    if (guess[i] === answer[i]) {
                        startGuess[i] = guess[i];
                    }
                }
                grid.style.removeProperty("display");

            }
            onClear();

        }
        
        function getColors (guess) {
            var colors = [];
            for(var i=0; i < 9; i++) {
                if (guess[i] === answer[i]) {
                    colors.push("lightgreen")
                } else {
                    var rowStart = i - i%3;
                    var columnStart = i%3;
                    var otherColumns = [answer[columnStart], answer[columnStart + 3],answer[columnStart + 6]];
                    var otherRows = [answer[rowStart], answer[rowStart + 1], answer[rowStart + 2]];
                    var rowMatch = otherRows.indexOf(guess[i]) >= 0 ;
                    var colMatch = otherColumns.indexOf(guess[i]) >= 0 ;
                    if (rowMatch || colMatch) {
                        colors.push("lightgray")
                    } else {
                        colors.push("none");
                    }
                }
            }
            return colors;
        }

        function onLoad()
        {
            var hash = window.location.hash;
            var genNew = true;
            var text;
            if (hash.length > 0) {
               var hashB = atob(hash.substring(1));
               var msg = hashB.substring(hashB.indexOf("|")+1);
               if (msg.length == 9) {
                text = msg.split("");
                genNew = false;
               }
            }

            if (genNew) {
                text = shuffleArray(["1","2","3","4","5","6","7","8","9"]);
                window.location.hash = btoa((Math.floor(Math.random()*10000)) + "|" + text.join(""));
            }

            window.answer = text;
            window.try = 0;
            window.maxTries = 5;
            onClear();

        }


        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
            
                // Generate random number
                var j = Math.floor(Math.random() * (i + 1));
                            
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
                
            return array;
        }

        function pressed(elem) {
            window.guess[guessAt] = elem.value;
            guessAt = window.guess.indexOf("x");
            renderGuess();

        }

        function renderGuess() {
            var grid = document.getElementById("guesstable");
            var tds = grid.getElementsByTagName("td");
            for (var i=0; i < window.guess.length; i++) {
                if (guess[i] === "x") {
                    tds[i].innerHTML = "";    
                } else {
                    tds[i].innerHTML = guess[i];    
                }
                tds[i].style["background"] = guessAt == i ? "blanchedalmond" : "none";
            }
            //btns
            document.getElementById("tickbtn").disabled = guessAt > -1;   
            for (var i=1; i<=9; i++) {
                document.getElementById("gbtn" + i).disabled = window.guess.indexOf(i+"") >= 0;   
            }
            document.getElementById("rndbtn").disabled = !document.getElementById("tickbtn").disabled;   

        }

        function onClear() {
            var elems = document.getElementsByClassName("guessbtn");
            for (let index = 0; index < elems.length; index++) {
                const element = elems[index];
                element.disabled = false;
            }
            
            window.guess = startGuess.slice(0);
            window.guessAt = 0;
            renderGuess();
        }

        function onRandom() {
            var rest = [];
            for(var i=1; i<=9; i++) {   
               if (guess.indexOf(i+"") < 0) {
                   rest.push(i+"");
               }     
            }

            rest = shuffleArray(rest);
            var r=0;
            for(var i=0; i<9; i++) {   
               if (guess[i] == "x") {
                   guess[i] = rest[r];
                   r++;
               }     
            }
            guessAt = -1;
            renderGuess();
        }

        function onGuessAt(gat) {
            window.guessAt = gat;
            renderGuess();
        }

    </script>
    <style>
        table {
            margin: 1em auto;
        }

        td {
            height: 30px;
            width: 30px;
            border: 1px solid;
            text-align: center;
        }

        td:first-child {
            border-left: solid;
        }

        td:nth-child(3n) {
            border-right: solid;
        }

        tr:first-child {
            border-top: solid;
        }

        tr:nth-child(3n) td {
            border-bottom: solid;
        }

        input {
            width: 3em;
            height: 3em; 
            font-weight: bold;      
        }
    </style> 
</head>

<body onload="onLoad()">
    <h2 style="text-align: center;">Sudokle</h2>

    <table id="guesstable" border="1" style="border-collapse: collapse;">
        <tr class="row">
             <td class="cell" onclick="onGuessAt(0)"></td>
             <td class="cell" onclick="onGuessAt(1)"></td>
             <td class="cell" onclick="onGuessAt(2)"></td> 
        </tr>
        <tr class="row">
            <td class="cell" onclick="onGuessAt(3)"></td>
            <td class="cell" onclick="onGuessAt(4)"></td>
            <td class="cell" onclick="onGuessAt(5)"></td> 
       </tr>
       <tr class="row">
            <td class="cell" onclick="onGuessAt(6)"></td>
            <td class="cell" onclick="onGuessAt(7)"></td>
            <td class="cell" onclick="onGuessAt(8)"></td> 
        </tr>    
    </table>
    <div style="margin: 1em auto; width: 25em;">

        <input class="guessbtn" id="gbtn1" type="button" onclick="pressed(this)" value="1"/>
        <input class="guessbtn" id="gbtn2" type="button" onclick="pressed(this)" value="2"/>
        <input class="guessbtn" id="gbtn3" type="button" onclick="pressed(this)" value="3"/>
        <input class="guessbtn" id="gbtn4" type="button" onclick="pressed(this)" value="4"/>
        <input class="guessbtn" id="gbtn5" type="button" onclick="pressed(this)" value="5"/>
        <input class="guessbtn" id="gbtn6" type="button" onclick="pressed(this)" value="6"/>
        <input class="guessbtn" id="gbtn7" type="button" onclick="pressed(this)" value="7"/>
        <input class="guessbtn" id="gbtn8" type="button" onclick="pressed(this)" value="8"/>
        <input class="guessbtn" id="gbtn9" type="button" onclick="pressed(this)" value="9"/>


    
         
    </div>
    <div style="margin: 0em auto; width: 8em">
        <input type="button" onclick="onClear()" value="X"/>
        <input id="tickbtn" type="button" onclick="onGuess()" value="âœ”" disabled/>
        <input id="rndbtn" type="button" onclick="onRandom()" value="ðŸŽ²" />
    </div>
    
    <table id="grid1" border="1" style="border-collapse: collapse; ">
        <tr class="row">
             <td class="cell"></td>
             <td class="cell"></td>
             <td class="cell"></td> 
        </tr>
        <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
       </tr>
       <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
        </tr>    
    </table>

    <table id="grid2" border="1" style="border-collapse: collapse; ">
        <tr class="row">
             <td class="cell"></td>
             <td class="cell"></td>
             <td class="cell"></td> 
        </tr>
        <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
       </tr>
       <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
        </tr>    
    </table>

    <table id="grid3" border="1" style="border-collapse: collapse; ">
        <tr class="row">
             <td class="cell"></td>
             <td class="cell"></td>
             <td class="cell"></td> 
        </tr>
        <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
       </tr>
       <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
        </tr>    
    </table>


    <table id="grid4" border="1" style="border-collapse: collapse; ">
        <tr class="row">
             <td class="cell"></td>
             <td class="cell"></td>
             <td class="cell"></td> 
        </tr>
        <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
       </tr>
       <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
        </tr>    
    </table>

    <table id="grid5" border="1" style="border-collapse: collapse; ">
        <tr class="row">
             <td class="cell"></td>
             <td class="cell"></td>
             <td class="cell"></td> 
        </tr>
        <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
       </tr>
       <tr class="row">
            <td class="cell"></td>
            <td class="cell"></td>
            <td class="cell"></td> 
        </tr>    
    </table>

    <div style="margin: 0em auto; width: 2em;">
        <input type="button" onclick="onNew()" value="New" />    
    </div>
    <h3 style="text-align: center;">Share URL for same puzzle</h3>


</body>

</html>
